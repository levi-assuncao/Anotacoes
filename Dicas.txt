https://www.youtube.com/watch?v=NBPOCB05o9E


Indice
PBX
SZ.chat 
Segurança
REDES
licença: IYLIRIXLTB
senhas

root: F0rt!c$2019@123
Admin: F0rt!c$2019@123Admin
 
ramal levi
8207 7yrnqZTzbt
8149 QMEqZE1kmP
8210 L5rj4fKO6K
sala de conferencia 14

usuário: suporte
ip: voip.fortics.con.br
senha: p@H5cU3!oZuRqY!7ZfB!4

Chabe disco secndário 065681-172975-201916-180224-654533-641157-105578-106700
suporte@fortics.com.brSenha: Suport!1@3
levi@fortics.com.br 135qet!#%QET
levi.assuncao 135qet!#%QET
levi.assuncao  135qet!#%QET
levi@fortics.com.br 12qw!@QW
firefox: AQ23 54ZP KN9X 5V2H RHVM SFKY DHB3 A1P1
chave api tts:AIzaSyASGs9xZjuw585Nixo0fy-6t8xo8B4aZk0


https://dark.smartzap.com.br/sz4/sz4/-/issues
[11:50] Mayara Nogueira
Segue nova senha: u>o1ONL9l4>g
Usuário: suporte
URL: https://dark.smartzap.com.br/sz4/sz4/-/issues
Sign in · GitLab
.


Cliente lispbx
ALCANTARA PINTO ASSE
SUPERZON
FALCAO OTOCH ADMINISTRACAO IMOBILIARIA
======================= #####    PBX    ##### =======================


## Discador abandono ##
Consulta se exite discagens ocorrendo: SELECT * FROM lis_discador_abandonos WHERE status=9;

## Data de instalação PBX ##
rpm -q --qf "%{INSTALLTIME:date}\n" basesystem estávals -lct /etc | tail -1 | awk '{print $6, $7, $8}'

## Verificar codecs instalados #####
tag: codec, g729
rasterisk -x "core show translation"

## Teste de escrita disco ##
dd if=/dev/zero of=./largefile bs=4M count=1024

## Teste de leitura disco ##
sh -c “sync && echo 3 > /proc/sys/vm/drop_caches” --> Limpa cache
dd if=./largefile of=/dev/null bs=4k
OBS: o nome "largefile" é mesmo utilizado no arquivo criado de teste de escrita

## Acesso a equipamentos ##
Tag: Nat forward
iptables -t nat -I POSTROUTING -s 10.10.3.251/32 -d 192.168.15.146/32 -p tcp -m tcp --dport 80 -j SNAT --to-source 192.168.15.145
iptables -t nat -I PREROUTING -p tcp -m tcp --dport 8081 -j DNAT --to-destination 192.168.15.146:80

Liberaçaõ de encaminhamento: echo 1 > /proc/sys/net/ipv4/ip_forward

## Edição rotas de entrada ##
Tag: tronco de entrada, 

[tronco-0800_net]
 exten = s,1,Set(NUMENTRADA=${CUT(CUT(SIP_HEADER(To),@,1),:,2)})
 same =   n,Noop(${NUMENTRADA})
 same =   n,Goto(tronco-2BTALK,${NUMENTRADA},1)
 same =   n,Hangup()
[tronco-0800_net] --> tronco no qual a ligação chega 
tronco-2BTALK --> Troncono qual a ligação é encaminhada

## habilitar debug puthon
tag: Debug, python, agi
agi set debug on

## sem registro de chamadas nas filas ###
Tag:queue, fila, abandono, registro
Recarregad os modulos das filas
rasterisk -x "reload"; rasterisk -x "queue reload all"

## Reproduzir tempo medio de espera para atendimento para cliente ###
Tag: Fila, espera, audio
Atualziar campo announce_holdtime tabela queue_table
update queue_table set announce_holdtime='no' ;
Com isso o tempo de espera não irá mais ser reproduzido ao cliente.

## Portabilidade pelo pano de discagem ###
Tag: portabildade, diferente, duas portabilidades
no arquivo extensions.conf 
exten = s,n,ExecIf($["${MACRO_CONTEXT}" != "DLPN_portabilidade2"]?AGI(portabilidade.agi,${MACRO_EXTEN}):AGI(portabilidade_2.agi,${MACRO_EXTEN})) ;Feito por Mayara Ticket 59099

## sem portabildade #####
exten = s,n,GotoIf($["${MACRO_CONTEXT}" = "DLPN_Discagem_84"]?noportab)
;Teste de portabilidade
exten = s,n,AGI(portabilidade.agi,${MACRO_EXTEN})
exten = s,n(noportab),NoOp(${MACRO_CONTEXT})



### CAllback sem atendimento ####
Tag: callback, sem custo, 0800
extensions_default_custom.conf
exten = 9994,1,Progress()
 same =      n,Playback(/opt/liberty/lispbx/sounds/custom/CALLBACK_VERwav,noanswer)
 same =      n,AGI(callback.agi,339,${CALLERID(num)})
 same =      n,Hangup()

##### ssh adicionar chave #######
Cliente gernado chave: 
ssh-keygenca
cat ~.ssh/id_rsa.pub 
servidor
vim /home/suporte/.ssh/authorized_keys

#### Alterar bina #######
tag: bina, callerid
[macro-clidtrunk]
exten => s,1,Set(TRUNK=${DB(LIS/trunk/${ARG1}/callerid)})
 same =>   n,ExecIf($["x${TRUNK}" != "x" & "x${TRUNK}" != "x8530488649"]?Set(CALLERID(num)=${TRUNK}))
 same =>   n,ExecIf($["x${TRUNK}" = "x8530488649"]?Set(CALLERID(num)=853048${RAND(8601,8649)}))




##logs banco ##
tag: log, consulta, variable
habiltar log mariadb: set global general_log=on;
Variável com nome do arquivo de log: general_log_file
Local do log: /var/lib/mysql


#### criar usuário para consultas ####
tag: BI, CONSULTAS
CREATE USER 'novousuario'@'%' IDENTIFIED BY 'senha'; -- acesso por qualquer outro ip

GRANT SELECT ON `lispbx`.* TO 'usuario'@'%'; -- para permissão somente de select

GRANT ALL PRIVILEGES ON `lispbx`.* TO 'usuario'@'%'; -- para da permissão de tudo no banco de dados informado 

FLUSH PRIVILEGES; -- recarrega as configs
https://www.digitalocean.com/community/tutorials/como-criar-um-novo-usuario-e-conceder-permissoes-no-mysql-pt

#### Status as ligações #######
tag: Status, 
0 - Pendente 
1 - Sucesso
2 - Máquina
3 - Ocupado - Status considerado sem sucesso.
4 - Não atende - Status considerado sem sucesso.
5 - Não existe/falha - Status considerado sem sucesso.
6 - Bloqueado
7 - sem rota
8 - NAO TEM
9 - Em andamento
10 - abandono




######  Peer sip #######

[99999]
type=friend
host=dynamic
;rtptimeout=10
username=99999
secret=Ho#h3RUx
progressinband=yes
prematuremedia=no
ignoresdpversion=yes
insecure=invite,port
fromuser=
context=tronco-99999
nat=force_rport,comedia
prack=yes
language=pt_BR
disallow=all
allow=alaw
allow=g729
dtmfmode=rfc2833


##### regsitro tronco sip ######
tag: sip registro tronco
register => usuário:senha@servidor_sip/contexto_pbx


##### compartilahemtno ######
SMB pasta windows
Compatilahr pasta com usuário e senha 
mount -t cifs //192.168.159.204/agi /mnt/ -o vers=2.0,user=casa,password=123



LIS PBX
IPs Fortics.

portab.fortics.com.br
187.58.67.91
porta 81 - TCP
vpn.fortics.com.br
187.58.67.92
porta da VPN - UDP ou TCP de acordo com o cliente.
hydra.fortics.com.br
177.22.34.58
porta da VPN - UDP ou TCP de acordo com o cliente.
update.fortics.com.br
177.22.34.57
porta 80 - TCP
registro.fortics.com.br
177.190.148.213
porta 80 - TCP
consulta.fortics.com.br
186.202.184.242
porta 80 - TCP


***************************
Acessos lisPBX E Fortics PBX
lis2.0
Senha admin: Ast*Lis64
Senha console: Ast*Lish64

Fortics PBX
Senha admin: Lis3_64
Senha console: Lis3_64toor

Habilita forçar o desligamento pelo operador
root@lispbx:/etc/asterisk]# vim chan_dahdi.conf 
mfcr2_forced_release=yes


Habilita debug da placa e1
mfcr2_call_files=yes

Verificar agentes logados
VAlidar se esta logado na fila

[root@lispbx:~]# rasterisk -x "queue show 116" | grep 538
      538 (Agent/538 from Agent/538) (ringinuse disabled) (realtime) (paused) (Not in use) has taken 12 calls (last was 87 secs ago)

Valida se agente esta logado
[root@lispbx:~]# rasterisk -x "agent show online" | grep 525
538          (willianne.mary) logged in on Khomp/B0C22-0.0 is idle (musiconhold is 'default')

Deslogar agente
lispbx*CLI> agent logoff Agent/538
Logging out 538

*******
Modulos
*******
*******
Portabilidade
*******
Fortics PBX 

Consulta: /var/lib/asterisk/agi-bin/portabilidade.agi 85989297893 1


não consulta portabilidade

exten = s,n,ExecIf($["${MACRO_CONTEXT}" = "DLPN_paulo_vieira"]?noportab)
exten = s,n,AGI(portabilidade.agi,${MACRO_EXTEN})
exten = s,n(noportab),Macro(lis-cadeado)


*******
agente online
*******

Realizar as seguintes alterações no arquivo agent.conf

#include extensions_agent.conf
musiconhold => musica_agent

Criada a classe de musica de espera musica_agent onde foi adicionado um audio de silêncio

Todos os agentes devem ter codigos diferentes de ramais.


*******
Discador
*******


Para importat mais de um numero no memso registro deve montar o arquivo com seguinte formato.

telefone1;telefone2;telefone3;telefone4;telefone5;telefone6;campo1;campo2;campo3;campo4;campo5;codcliente

É obrigatório o usu de 12 campos onde os 6 primeiros deve ser numeros e ultimo código caso alguma das informações não existe a coluna deve exixtir vazia.




*******
derrubar ligações
*******

soft hangup SIP/8171-00008cbc
caso canal seja muito grtande usar show channels concise 

caso esteja com agi só derruba matando processo.

rasterisk -x "show channels verbose" | grep 137
Local/64@DLPN_corret default              h                   5 Up      AGI          delcallerid.agi,148666381 8334313479      137:21:2  

[root@lis-camed:~]# ps fuxa | grep aste
root     152149  0.0  0.0 112664   984 pts/1    S+   08:34   0:00          \_ grep --color=auto aste
root       1862  0.0  0.0  91268  2064 ?        Ss   Fev08   0:01 /usr/libexec/postfix/master -w
root       3527  0.0  0.0 115244   808 ?        S    Fev08   0:00 /bin/sh /usr/sbin/safe_asterisk
root       3530 30.4  2.2 15178812 722104 ?     SLl  Fev08 2802:57  \_ /usr/sbin/asterisk -f -vvvg -c
root      23435  0.0  0.7 14770684 248924 ?     S    Fev09   0:00      \_ /usr/sbin/asterisk -f -vvvg -c
root       3666  0.0  0.0 121508  5224 ?        S    Fev08   7:04 /bin/bash /opt/liberty/lispbx/scripts/asterisk/daemon_lispbx start

kill -9 3530

Monitorar 

[root@lis3:~]# rasterisk  | grep 30348181
MFC/R2 call offered on chan 132. ANI = 8530348181, DNIS = 2550, Category = National Subscriber
    -- Executing [2550@DID_trunk_Oi-34571600-LOCAL:1] Macro("DAHDI/132-1", "userfield,8530348181") in new stack


********************
Configurar dongle
********************


gammu-detect > /root/.gammurc 


[root@ConnectService:/dev]# gammu 0 identify
Dispositivo          : /dev/ttyUSB0
Fabricante           : Huawei
Modelo               : unknown (E1752)
Firmware             : 11.126.03.01.314
IMEI                 : 353220047556144
SIM IMSI             : 724118112508435


1 - criar o tronco na interface do lispbx
trunk_GSM_DONGLE = dandhi

2 - alterar tipo de tronco no banco de dados para dongle

mysql> select * from trunks where id=8 \G;
*************************** 1. row ***************************
               id: 8
             nome: GSM_DONGLE
               ip: 
            ramal: NULL
            senha: 
             tipo: DONGLE
              max: 1
         callerid: 
             voip: 0
            codec: 
          context: 
          minutos: 
       transbordo: 
 tarifftransbordo: 
        delprefix: 
        addprefix: 
        endprefix: 
  totalminutosmes: 0
dataupdateminutos: 0000-00-00
    diavencimento: 
1 row in set (0.00 sec)


3 - Alterar em globalvar_trunks.conf tipo de tronco para dongle
trunk_GSM_DONGLE = DONGLE

4 - cadastrar o grupo com imei do modem em dongle.conf
[gsm-6144]
imei=353220047556144

5 - cadastrar grupo em extensions.conf
[dongle-incalling]
exten = _.,1,DumpChan()
same  = n,Goto(DID_trunk_DONGLE,${EXTEN},1)

6 - adicionar tronco de entrada
include => lis-inrt-IN_DONGLE



mysql> select * from trunks;
mysql> select * from trunks where id=8;
+----+------------+----+-------+-------+--------+-----+----------+------+-------+---------+---------+------------+------------------+-----------+-----------+-----------+-----------------+-------------------+---------------+
| id | nome       | ip | ramal | senha | tipo   | max | callerid | voip | codec | context | minutos | transbordo | tarifftransbordo | delprefix | addprefix | endprefix | totalminutosmes | dataupdateminutos | diavencimento |
+----+------------+----+-------+-------+--------+-----+----------+------+-------+---------+---------+------------+------------------+-----------+-----------+-----------+-----------------+-------------------+---------------+
|  8 | GSM_DONGLE |    | NULL  |       | DONGLE |   1 |          |    0 |       |         |         |            |                  |           |           |           | 0               | 0000-00-00        |               |
+----+------------+----+-------+-------+--------+-----+----------+------+-------+---------+---------+------------+------------------+-----------+-----------+-----------+-----------------+-------------------+---------------+

[root@ConnectService:/etc/asterisk]# vim globalvar_trunks.conf 
[root@ConnectService:/etc/asterisk]# cat globalvar_trunks.conf
trunk_PORTABILIDADE = SIP/LISPBX
trunk_Entrada_chips = KHOMP
trunk_EBS_GSM_TIM = KHOMP/Gtim
trunk_EBS_GSM_VIVO = KHOMP/Gvivo
trunk_E1_GVT_8530315000 = KHOMP/Ggvt
trunk_EBS_GSM_OI = KHOMP/Goi
trunk_GSM_DONGLE = DONGLE
ConnectService*CLI> database show LIS/trunk
/LIS/trunk/trunk_GSM_DONGLE/maxchannels           : 1                        

s:72411/ ---> imsi

Cadastrar os modens em dongle.conf
E na rota de saida adiconar antes do umero o codigo da operadora 

s:72411/

ring falso 
no extension.conf
adicionar r
sem ring OPD = TtwWgHhKko
com ring OPD = TtwWgHhKkor

*********
**Khomp**
*********
Arquivo de configuração da interface do servidor
/etc/khomp/config/kibs.yaml


*********
**Asterisk**
*********
atualziar a binar com from do sip
exten = _XXXX,1,Set(CALLERID(num)=${CUT(CUT(SIP_HEADER(From),@,1),:,2)})

===============================
Diferenciar troncos sip com mesmo provedor
[tronco-0800_Claro]
 exten = s,1,Set(NUMENTRADA=${CUT(CUT(SIP_HEADER(To),@,1),:,2)})
 same =   n,Noop(${NUMENTRADA})
 same =   n,Goto(tronco-2BTALK,${NUMENTRADA},1)
 same =   n,Hangup()

==================================
emviar bina no tronco sip

exten = 989297893,1,Set(CALLERID(name)=8535217521)
exten = 989297893,n,Dial(SIP/TELLFREE2/5585${EXTEN})
exten = 989297893,n,Hangup()
[13:50:55] LIberty - Lucas Nunes: [TELLFREE2]
username=7003415
type=friend
secret=74024304
qualify=no
insecure=very
host=sip2.tellfree.net
fromuser=7003415
fromdomain=sip2.tellfree.net
domain=sip2.tellfree.net
disallow=all
context=from-tellfree
allow=g729:30
allow=alaw
callerid=8535217521
fromname=8535217521
fromnumber=7003415@sip2.tellfree.net
dtmfmode=rfc2833


*********
**MYSQL**
*********

**********************************************
===== Exportar para csv ======================
**********************************************

mysql>  select calldate, src, dst from cdr where calldate > "2017-01-01-00:00:00" and calldate < "2017-02-12-23:59:59" INTO OUTFILE '/tmp/2017.csv'  FIELDS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\n';
Query OK, 70157 rows affected (0.10 sec)


**********************************************
===== Tamanho da tabela ======================
**********************************************

 SELECT table_schema "cdr", sum( data_length + index_length ) / 1024 / 1024 "Data Base Size in MB" 
 FROM cdr GROUP BY table_schema  like 'cdr';




**********************************************
===== Corrigir erro fatal 4 ==================
====== Consulta relatório URA ================
**********************************************

mysql lispbx -e "ALTER TABLE cdr201408 ADD peeraccount varchar(50) NOT NULL DEFAULT '' AFTER accountcode, ADD trunkout varchar(80) NOT NULL DEFAULT '' AFTER trunkin, ADD sequence varchar(32) NOT NULL DEFAULT '' AFTER trunkout, ADD linkedid varchar(32) NOT NULL DEFAULT '' AFTER sequence;

mesa operadora
http://10.10.2.60/mesa3/

**********************************************
===== Integrações LisPBX =====================
**********************************************


Virtua

Deamon
[root@lispbx:~]# /etc/init.d/virtua status
safe_virtua (pid 6522) está em execução...

Log 
[root@lispbx:~]# cat  /var/log/asterisk/virtua.log

Processos
[root@lispbx:~]# ps fuxa | grep virtu
root     10311  0.0  0.0   4336   768 pts/1    S+   15:21   0:00          \_ grep virtu
root      6522  0.0  0.0   5032   636 pts/1    S    15:15   0:00 /bin/sh /opt/lispbx/scripts/safe_virtua
root      6526  0.0  0.0  34460 11260 pts/1    S    15:15   0:00  \_ /usr/bin/php /opt/lispbx/scripts/virtuasocket.php

Firewall

[root@lispbx:~]# iptables-save | grep 4042
-A INPUT -s 192.168.0.0/16 -p tcp -m tcp --dport 4042 -j ACCEPT 

Boot
[root@lispbx:~]# chkconfig --list | grep virt
virtua         	0:não	1:não	2:sim	3:sim	4:sim	5:sim	6:não


You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'ASSIS TIMOTEO OLIVEIRA', '162943', '0', 'numero', '100', '1', '100', '', '860965' at line 1

TAlk Easy

monitoramento
tcpdump -SAnni any port 5038


**********************************************
===== Arquivos  LisPBX =====================
**********************************************
features.conf
Ajustar tempo para considerer ramais indisponíveis
atxfernoanswertimeout= 40

Arquivo de firewall ==> /etc/sysconfig/iptables ( contem as regras de firewall aplicadas via console


**********************
======================
MESA OPERADORA 3
======================
**********************
1 - Alterar a linha abaixo no arquivo /opt/lispbx/scripts/lis_amisocket.js:

De:
var ami = new Asterisk({host:'localhost',username:'lispbx',password:'lispbx',port:'5038'});
Para:
//  var ami = new Asterisk({host:'localhost',username:'lispbx',password:'lispbx',port:'5038'});
var ami = new Asterisk({host:'localhost',username:'mesa',password:'mesa3',port:'5038'});


2 - Criar o usuário abaixo no manager do asterisk (colocar a rede do cliente, e não 211.0.88.0):
[mesa]
secret=mesa3
deny=0.0.0.0/0.0.0.0
permit=127.0.0.1/255.255.255.255
permit=211.0.88.0/255.255.254.0
read = system,call,log,verbose,agent,user,config,dtmf,reporting,cdr,dialplan
write = system,call,agent,user,config,command,reporting,originate

3 - rasterisk -x "manager reload"

4 - Criar o arquivo /opt/lispbx/scripts/check_mesa.sh com o conteúdo abaixo:
#/bin/bash
manager=`rasterisk -x "manager show connected" | grep 'mesa' | awk '{print $1}'`
if [ "$manager" = "mesa" ]; then
#       echo "Existe"
exit 0
else
#       echo "Nao Existe"
/etc/init.d/lisami restart
fi

5  - Dar permissão de execução:
chmod +x /opt/lispbx/scripts/check_mesa.sh 

6 - Inserir o script no crontab:
 *   * * root /opt/lispbx/scripts/check_mesa.sh

7 - Restartar o lisami:
[root@cequip_matriz:~]# service lisami restart
Parando o Lisami:                               DOMINGOS NETO (1089)
5310
Padrao
2017-07-20 18:01:50           [  OK  ]
Iniciando o Lisami:                                        [  OK  ]


*********************
Sigma
*********************
Log
tail -f /var/log/asterisk/sigma.log

http://192.168.10.242:8081/SigmaWebServices/&gdst=4333570408&gkey=masterseg123@&gacao=callura




Filas de atendimento

/bin/bash /opt/liberty/lispbx/scripts/websocket/daemon_notification start


======================= ##### Banco ##### =======================

## Tabelas ##
| audit                           |
| callerid                        | Id das ligações que estão na fila (ligação que aparece na tela do monitor de filas)
| callerid_discador               | Id das ligações realizadas pelo discador (id que aparece na tela do agente.)
| cdr                             |
| delete_abandono                 |
| lis_agente_retorno              |
| lis_agente_retorno_historico    |
| lis_agentes                     |
| lis_agentes_filas               |
| lis_agentes_online              |
| lis_asterisk_queue_commands     |
| lis_bloqueio_lista              |
| lis_bloqueio_lista_numeros      |
| lis_bloqueios                   |
| lis_callback                    |
| lis_callback_numeros            |
| lis_campanhas                   |
| lis_campanhas_agentes           |
| lis_campanhas_status            |
| lis_centro_custo                |
| lis_centro_custo_membros        |
| lis_chamada_espera              |
| lis_comandos                    |
| lis_comentario_chamadas         |
| lis_conf_backup_restore         |
| lis_conf_datahora               |
| lis_conf_discagem_rapida        |
| lis_conf_lispbx                 |
| lis_conf_portabilidade          |
| lis_conferencia                 |
| lis_conferencia_agendamento     |
| lis_contatos                    |
| lis_contatos_numeros            |
| lis_crm_historico               |
| lis_ddd                         |
| lis_ddd_discadas                |
| lis_ddd_recebidas               |
| lis_ddd_regiao                  |
| lis_desvio                      |
| lis_desvio_horario              |
| lis_desvio_horario_grupos       |
| lis_disa                        |
| lis_discador_abandonos          |
| lis_discador_agendamento        |
| lis_discador_campanhas          |
| lis_discador_cdr                |
| lis_discador_clientes           |
| lis_discador_conf_geral         |
| lis_discador_discagem_11        |
| lis_discador_discagem_12        |
| lis_discador_discagem_13        |
| lis_discador_discagem_3         |
| lis_discador_discagem_5         |
| lis_discador_discagem_6         |
| lis_discador_discagem_7         |
| lis_discador_discagem_8         |
| lis_discador_discagem_9         |
| lis_discador_filtro             |
| lis_discador_filtro_filtro      |
| lis_discador_filtro_prioridade  |
| lis_discador_integracao         |
| lis_discador_mailing            |
| lis_discador_resumo             |
| lis_discador_spool              |
| lis_discador_tipofone           |
| lis_discador_tipofone_perfil    |
| lis_discador_transbordos        |
| lis_fax                         |
| lis_fax_relatorio               |
| lis_fila_download               |
| lis_formularios                 |
| lis_formularios_relatorio       |
| lis_gravacao_hash               |
| lis_gravacoes_ouvidas           |
| lis_grupo_captura               |
| lis_grupo_captura_ramais        |
| lis_grupo_centro_custo          |
| lis_grupo_discagem              |
| lis_grupo_discagem_rotas        |
| lis_grupo_horarios              |
| lis_grupo_horarios_restricoes   |
| lis_grupo_perfil_remoto         |
| lis_grupo_perfil_remoto_membros |
| lis_grupo_ramais                |
| lis_grupo_ramais_membros        |
| lis_integracao                  |
| lis_integracao_campos           |
| lis_lista_ntp                   |
| lis_lista_operadoras            |
| lis_lista_ramais_custom         |
| lis_mail_queue                  |
| lis_modo_noturno                |
| lis_notificacoes                |
| lis_notificacoes_relatorio      |
| lis_operadoras_anatel           |
| lis_pausas                      |
| lis_perfil_portabilidade        |
| lis_perfil_remoto               |
| lis_pesquisa                    |
| lis_pesquisa_perguntas          |
| lis_pesquisa_relatorio          |
| lis_playlist                    |
| lis_playlist_musicas            |
| lis_portabilidade_numero        |
| lis_portabilidade_numero2       |
| lis_portabilidade_numero3       |
| lis_portabilidade_relatorio     |
| lis_portabilidade_resumo        |
| lis_prefixo_anatel              |
| lis_prefixo_anatel_update_old   |
| lis_ramais                      |
| lis_relatorio_personalizados    |
| lis_rotas_entrada               |
| lis_rotas_entrada_horario       |
| lis_rotas_portabilidade         |
| lis_rotas_saida_horario         |
| lis_rotas_saidas                |
| lis_rotas_saidas_rotas          |
| lis_status_chamadas             |
| lis_table_use                   |
| lis_tarifas                     |
| lis_troncos                     |
| lis_ura                         |
| lis_ura_lista_opcoes            |
| meetme                          |
| queue_log                       |
| queue_member_table              |
| queue_table                     |

######Consultas direto no console ########

mysql lispbx -pKvallo1931 -e "show full processlist;"


###############

#### agente online Fortics ########


moi-vlcepabx-02*CLI> queue show 310
310 has 0 calls (max unlimited) in 'leastrecent' strategy (0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   Members: 
      461 (Local/4061@default/n from SIP/4061) (ringinuse disabled) (realtime) (Not in use) has taken no calls yet
      511 (Local/511@lis-func-agent-dial/n from Agent:511) (ringinuse disabled) (realtime) (Unavailable) has taken no calls yet ---> Esta é representação de agnete online na fila de atendimento


############### Habilitar log ###############

tag: log, full
set global general_log=ON
Local do log: /var/lib/mysql/
Nome do arquivo esta na variável: general_log_file
Rodando o seguinte comando: Show variables
| general_log_file | intervig.logZ



######################################

1º: rename table cdr to cdr_crash_10072019;

2º: repair cdr_crash_10072019;

3º: copia a cdr de outro cliente 

mysqldump lispbx -pKvallo1931 --table cdr --no-data > cdr.sql

4º: mysql lispbx -pKvallo1931 < cdr.sql

###########################################


sed -n -e '/DROP TABLE.*lis_discagem'\`'/,/UNLOCK TABLES/p' lispbx.dump.sql > lis_discagem.sql
mysql lispbx < lis_discagem.sql
##############

Alterar capons de coluna mysql
ALTER TABLE NOME_DA_TABELA ALTER COLUMN NOME_DO_CAMPO VARCHAR(100)
######################
Adicionar campos na tabel mysqlALTER TABLE Tabela ADD Nome VARCHAR(40)

#######
rastrear numumero na cdr

select calldate, src, dst, trunkin,trunkout from cdr where calldate like '%2020-08-27%' and (dst=14997778020 or src=14997778020) \G


#########
alterar tamanho campos para suportar mais campanhas
campanhas, filas, editar tabelas
alter table lis_agentes_online modify fila varchar(250) not NULL;
alter table lis_campanhas modify fila varchar(250) not NULL;



##### consultas  ######
## consulta um dia atras
 mysqldump lispbx --table cdr -pKvallo1931 '--where=calldate >= DATE_SUB(CURDATE(),INTERVAL 1 DAY)'


==========================  ###### khomp ####### +==================

Verificar placa travada
tag: placa E1, travar
cat /proc/interrupts | grep kpe



======================= ##### SZ.chat ##### =======================






======================= ##### Segurança ##### =======================






======================= #####   REDES   ##### =======================



======================= #### Outros #### ======================

###### verificado se servidor é virtualizado
tag: virtualização, vmware,hypervi
dmidecode -s system-manufacturer

###### Configuração de rota UMG ######
tag: UMG, Regex, Edição 

^(55)(.*)$
/^(55)(.*)$/$2/

^(55)(.*)$ --->  prefixo para escolha da rota de saida numero deve iniciar com 55 e divide o numero em duas partes 55 + número
/^(55)(.*)$/$2/ --> edita o numero dividido em duas partes onde parte 1 é 55 e parte 2 é número e remove a parte 1 mantendo apenas parte 2


###### Dongle ######
Checa quais modens existem
rasterisk -x "dongle show devices"
ID           Group State      RSSI Mode Submode Provider Name  Model      Firmware          IMEI             IMSI             Number        
TIM-1817     2     Free       13   0    0       TIM 85         E1756C     11.126.10.09.18   352143046171817  724028201742448  Unknown       
TIM-5600     2     Free       12   0    0       TIM            E1756C     11.126.10.09.18   352143046195600  724028201517380  +5585999516335
TIM-5889     2     Free       19   0    0       TIM 85         E1756C     11.126.10.09.18   352143046525889  724028029419576  Unknown       
VIVO-3510    3     Free       17   0    0       VIVO           E1756C     11.126.10.13.202  352143042583510  724118505551276  Unknown       


352143046157295
352143040685259

Adiciona o modem no vim /etc/asterisk/dongle.conf

[TIM-5259]
group=2
imei=352143040685259
context=dongle-incoming

recarrea modulo

AlcantaraPinto*CLI> module reload chan_dongle.so 
    -- Reloading module 'chan_dongle.so' (Huawei 3G Dongle Channel Driver)
  == Parsing '/etc/asterisk/dongle.conf': Found
[2017-02-09 10:36:29] NOTICE[13180]: chan_dongle.c:1578 reload_config: [TIM-teste] Loaded device
[2017-02-09 10:36:29] NOTICE[13180]: chan_dongle.c:1578 reload_config: [TIM-teste2] Loaded device
    -- [TIM-teste] IMEI 352143046157295 found on data_tty=/dev/ttyUSB17 audio_tty=/dev/ttyUSB16
    -- [TIM-teste] Trying to connect on /dev/ttyUSB17...
    -- [TIM-teste] Dongle has connected, initializing...
    -- [TIM-teste2] IMEI 352143040685259 found on data_tty=/dev/ttyUSB11 audio_tty=/dev/ttyUSB10
    -- [TIM-teste2] Trying to connect on /dev/ttyUSB11...
    -- [TIM-teste2] Dongle has connected, initializing...
    -- [TIM-teste] Dongle initialized and ready
    -- [TIM-teste2] Dongle initialized and ready


TIM-1817     2     Free       12   0    0       TIM 85         E1756C     11.126.10.09.18   352143046171817  724028201742448  Unknown       
TIM-5600     2     Free       12   0    0       TIM            E1756C     11.126.10.09.18   352143046195600  724028201517380  +5585999516335
TIM-5889     2     Free       19   0    0       TIM 85         E1756C     11.126.10.09.18   352143046525889  724028029419576  Unknown       
VIVO-3510    3     Free       18   0    0       VIVO           E1756C     11.126.10.13.202  352143042583510  724118505551276  Unknown       
TIM-teste    2     Free       14   0    0       TIM            E1756C     11.126.10.09.18   352143046157295  724028201514111  Unknown       
TIM-teste2   2     Free       16   0    0       TIM 85         E1756C     11.126.10.11.110  352143040685259  724028201742449  Unknown    

======================= #### Zabbix #### ======================
zabbix_agentd -t system.cpu.load[all,avg1]
zabbix_agentd -t system.cpu.util[,idle]
zabbix_agentd -t vfs.fs.size[/,total]
zabbix_agentd -t vfs.fs.size[/,free]
   
